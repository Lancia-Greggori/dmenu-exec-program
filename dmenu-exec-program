#!/bin/sh

set -eu

[ -z "${DISPLAY+x}" ] && echo 'X server not found' && exit 1


CONFIG_FILE='.fpalias'

if [ ! -e "$HOME/$CONFIG_FILE" ]; then

	echo "no $CONFIG_FILE file found" | dmenu 

	exit 2

elif grep SPACE "$HOME/$CONFIG_FILE"; then

	echo 'bad configuration file format: no "SPACE" allowed' | dmenu

	exit 3

fi


# clear any previous aliases

for command_alias in $(alias | cut -d'=' -f1 | cut -d' '  -f2); do unalias "$command_alias"; done

IFS='
' 

for line in $(grep -v '^[# $]' "$HOME/$CONFIG_FILE"); do 

	ALIAS="$(echo "$line" | cut -d',' -f1 | sed 's/ /SPACE/g')"

	COMMAND="$(echo "$line" | cut -d',' -f2)"

	alias "$ALIAS=$COMMAND"

done

eval "$(alias | cut -d'=' -f1 | cut -d' ' -f2 | sed 's/SPACE/ /g' | dmenu -i | sed 's/ /SPACE/g')"
